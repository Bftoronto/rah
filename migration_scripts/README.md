# Миграция с бесплатных тарифов на Selectel

## Проблемы бесплатных тарифов

### Render (Backend)
- **Спин-даун**: Сервер останавливается после 15 минут неактивности
- **Холодный старт**: Первый запрос может занимать 30-60 секунд
- **Ограничения**: 750 часов в месяц, 512MB RAM, 0.1 CPU
- **Производительность**: Медленная обработка запросов при высокой нагрузке

### Netlify (Frontend)
- **Ограничения деплоев**: 100 деплоев в месяц
- **Размер файлов**: Ограничения на размер статических файлов
- **Задержки**: Возможные задержки при первом запросе

## Преимущества Selectel

### Производительность
- **Выделенные ресурсы**: Гарантированная производительность
- **Отсутствие спин-даунов**: Сервер работает 24/7
- **Быстрый отклик**: Стабильное время ответа < 100ms
- **Масштабируемость**: Возможность увеличения ресурсов

### Надежность
- **Uptime 99.9%**: Гарантированная доступность
- **Техническая поддержка**: Профессиональная поддержка 24/7
- **Резервное копирование**: Автоматические бэкапы
- **Мониторинг**: Встроенные инструменты мониторинга

### Безопасность
- **SSL сертификаты**: Автоматическое получение и обновление
- **DDoS защита**: Встроенная защита от атак
- **Firewall**: Настраиваемые правила безопасности
- **Изоляция**: Полная изоляция от других пользователей

## План миграции

### 1. Подготовка
```bash
# Создание бэкапа текущих данных
./migration_scripts/backup_render_data.sh

# Проверка целостности данных
./migration_scripts/validate_migration.sh
```

### 2. Настройка сервера Selectel
```bash
# Подготовка сервера
./migration_scripts/prepare_selectel_server.sh

# Развертывание приложения
./migration_scripts/deploy_to_selectel.sh <server_ip> <domain>
```

### 3. Обновление конфигурации
```bash
# Обновление DNS записей
# Настройка Telegram бота
# Тестирование функциональности
```

### 4. Мониторинг и оптимизация
```bash
# Настройка мониторинга
# Оптимизация производительности
# Настройка алертов
```

## Стоимость Selectel

### Минимальная конфигурация
- **CPU**: 1 vCPU
- **RAM**: 2 GB
- **SSD**: 20 GB
- **Стоимость**: ~$10/месяц

### Рекомендуемая конфигурация
- **CPU**: 2 vCPU
- **RAM**: 4 GB
- **SSD**: 40 GB
- **Стоимость**: ~$20/месяц

## Инструкции по миграции

### Шаг 1: Создание бэкапа
```bash
cd migration_scripts
./backup_render_data.sh
```

### Шаг 2: Подготовка сервера
```bash
# Замените на ваши данные
SERVER_IP="your_server_ip"
DOMAIN="your_domain.com"
SSH_KEY="~/.ssh/your_key"

./prepare_selectel_server.sh $SERVER_IP $SSH_KEY
```

### Шаг 3: Развертывание приложения
```bash
./deploy_to_selectel.sh $SERVER_IP $DOMAIN $SSH_KEY
```

### Шаг 4: Обновление DNS
1. Войдите в панель управления DNS
2. Обновите A-запись для вашего домена
3. Укажите IP адрес сервера Selectel
4. Подождите распространения DNS (до 24 часов)

### Шаг 5: Настройка Telegram бота
1. Откройте @BotFather в Telegram
2. Выберите вашего бота
3. Обновите URL Web App на новый домен
4. Протестируйте работу бота

## Проверка миграции

### Тестирование функциональности
```bash
# Проверка доступности
curl -I https://your_domain.com

# Проверка API
curl https://your_domain.com/health

# Проверка Telegram Web App
# Откройте бота в Telegram и протестируйте все функции
```

### Мониторинг производительности
```bash
# Проверка логов
ssh user@server_ip 'journalctl -u pax-backend -f'

# Проверка ресурсов
ssh user@server_ip 'htop'

# Проверка статуса сервисов
ssh user@server_ip 'systemctl status pax-backend'
```

## Оптимизации для Selectel

### Backend оптимизации
- **Кэширование**: Redis для кэширования данных
- **Connection pooling**: Оптимизация подключений к БД
- **Асинхронность**: Использование async/await
- **Сжатие**: Gzip сжатие ответов

### Frontend оптимизации
- **CDN**: Использование CDN для статических файлов
- **Кэширование**: Настройка кэширования браузера
- **Минификация**: Сжатие CSS/JS файлов
- **Lazy loading**: Отложенная загрузка компонентов

### Мониторинг
- **Health checks**: Регулярные проверки здоровья
- **Логирование**: Структурированные логи
- **Метрики**: Сбор метрик производительности
- **Алерты**: Уведомления о проблемах

## Troubleshooting

### Проблемы с подключением
```bash
# Проверка сетевого подключения
ping your_server_ip

# Проверка портов
telnet your_server_ip 80
telnet your_server_ip 443

# Проверка SSL сертификата
openssl s_client -connect your_domain.com:443
```

### Проблемы с базой данных
```bash
# Подключение к PostgreSQL
sudo -u postgres psql -d paxapp

# Проверка подключений
SELECT * FROM pg_stat_activity;

# Проверка размера БД
SELECT pg_size_pretty(pg_database_size('paxapp'));
```

### Проблемы с производительностью
```bash
# Мониторинг ресурсов
htop
iotop
nethogs

# Анализ логов
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

## Откат изменений

### В случае проблем
```bash
# Откат к предыдущей версии
./rollback.sh

# Восстановление из бэкапа
./restore_backup.sh

# Возврат к Render/Netlify
# Обновите DNS записи обратно
```

## Контакты поддержки

- **Selectel Support**: support@selectel.ru
- **Telegram**: @selectel_support
- **Документация**: https://selectel.ru/docs/

## Полезные ссылки

- [Selectel Pricing](https://selectel.ru/cloud/servers/)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Nginx Configuration](https://nginx.org/en/docs/) 